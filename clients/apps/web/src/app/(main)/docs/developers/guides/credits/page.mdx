---
title: Credits-based products with Polar
description: Evetything you need to know to implement credits-based Products with Polar
keywords: credits, usage, polar, payments, invoice, billing, saas, product, lemon squeezy, api, gatekeep
---

# Credits-based products with Polar

In this guide, we will be creating a Product which grants X amount of credits, which gatekeeps access to an API. It's perfect if you're building an AI application, where you want to deduct credits on every request hitting your API.

## The anatomy of Credits-based products

The requirements of creating a credit-system are:

- A mechanism to authenticate incoming requests
- An incrementation mechanism which runs on subsequent requests

Polar has the "License Key" benefit which can fit both of these requirements.

### License Keys with Credits

When creating a License Key benefit on Polar, you have the option to issue an arbitrary "Usage" limit. This essentially means that you can restrict the License Key to be used a certain amount of times.

In this guide, we will use "Usage" as our "Credits".

Imagine that you want to issue 2000 credits of some kind. We will then essentially configure the License Key to support 2000 Usages.

The nice thing with Polar's License Key benefit, is that we can easily increment usages by an arbitrary amount. It's up to you.

## Creating the Product

Go ahead and navigate to the Product Creation screen.

Fill in all the details of your product.

### License Key Benefit

When you reach the Benefit section at the bottom, expand the `License Key` section, and click "Create New".

Give your license key a description, preferrably including the credits you want to issue. Something like `500 API Requests`.

The trick is to enable the `Limit Usage` option, and set the amount to how many Credits you want to issue.

Hit "Create" and enable it on the new Product.

## Setting up the authentication mechanism

We will use Next.js API routes to illustrate on how you can use the Polar API to authenticate the requests. It should be fairly simple to translate to your specific usecase/framework.

### Installing the Polar SDK

Install the Polar SDK from npm:

```bash
pnpm add @polar-sh/sdk
```

You can use the REST API just as well, if you're integrating using another language.

### Add your Polar Organization ID

In order to make validation requests to Polar's API, we need to supply the Organization ID to the SDK.

You can find the Organization ID on the Polar Organization Settings page.

Go ahead and add it to your `.env` so that we can access it.

```bash
# .env
POLAR_ORGANIZATION_ID="..."
```

### Implementation with Next.js

```typescript
import headers from 'next/headers';
import { CoreMessage, streamText } from 'ai';
import { openai } from '@ai-sdk/openai';
import { headers } from "next/headers";

const polar = new Polar({
  server: 'sandbox', // Use sandbox for testing purposes - otherwise use 'production' or omit this line
})

// Configure this to your liking
// You could for example set this value depening on the tokens used from openai, etc.
const CREDIT_COST_PER_REQUEST = 1;

export async function POST(req: Request) {
  const { messages }: { messages: CoreMessage[] } = await req.json();
  const headersList = await headers();
  const licenseKey = headersList.get("Authorization")?.split(" ")[1];

  if (!licenseKey) {
    return new Response("Unauthorized", { status: 401 });
  }

  const validation = polar.users.licenseKeys.validate({
    organizationId: process.env.POLAR_ORGANIZATION_ID!,
    key: licenseKey,
    incrementUsage: CREDIT_COST_PER_REQUEST
  })

  if (!validation) {
    return new Response("Unauthorized", { status: 401 });
  }

  const result = await streamText({
    model: openai('gpt-4o-mini'),
    system: 'You are a helpful assistant.',
    messages,
  });

  return result.toDataStreamResponse();
}
```

This will take an incoming request, extract the License Key from the Authorization header, and pass that along to the license key validation function using the Polar SDK. If the validation passes, we go ahead and call whatever we want.

Using the `Ã¬ncrementUsage` parameter, we increase the "credits" for every request done.
